CREATE SCHEMA pteta_v2;

CREATE TABLE pteta_v2.gpsdata (
  id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  lat float NOT NULL,
  lng float NOT NULL,
  speed float NOT NULL,
  orientation float NOT NULL,
  gpstime TIMESTAMP NOT NULL,
  inDepo bool NOT NULL,
  vehicleId int NOT NULL,
  routeId int NOT NULL,
  response_datetime TIMESTAMP with TIME ZONE,
  edited TIMESTAMP DEFAULT now(),
  UNIQUE(lat, lng, speed, orientation, gpstime, vehicleId, routeId)
);

CREATE TABLE pteta_v2.vehicle(
  id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  imei varchar NOT NULL,
  name varchar NOT NULL,
  busNumber int NOT NULL,
  remark varchar,
  perevId int NOT NULL,
  edited TIMESTAMP with TIME ZONE DEFAULT now()
);

CREATE TABLE pteta_v2.owner (
  id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  perevName varchar NOT NULL,
  edited TIMESTAMP with TIME ZONE DEFAULT now()
);

CREATE TABLE pteta_v2.route (
  id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  routeName varchar NOT NULL,
  routeColour varchar,
  edited TIMESTAMP with TIME ZONE DEFAULT now()
);

alter TABLE pteta_v2.gpsdata ADD FOREIGN KEY (vehicleId) REFERENCES pteta_v2.vehicle (id);

alter TABLE pteta_v2.gpsdata ADD FOREIGN KEY (routeId) REFERENCES pteta_v2.route (id);

alter TABLE pteta_v2.vehicle ADD FOREIGN KEY (perevId) REFERENCES pteta_v2.owner (id);
